name: scaffold-feature
description: "Autonomously build new Keystone workflows and agents"

steps:
  - id: get_requirements
    type: human
    message: "Describe the workflow you want to build:"
    inputType: text

  - id: plan
    type: workflow
    needs: [get_requirements]
    path: scaffold-plan
    inputs:
      requirements: ${{ steps.get_requirements.output }}

  - id: generate
    type: workflow
    needs: [plan]
    path: scaffold-generate
    inputs:
      requirements: ${{ steps.get_requirements.output }}
      files: ${{ steps.plan.outputs.files }}

  - id: write_files
    type: file
    needs: [generate]
    foreach: ${{ steps.generate.outputs.files }}
    op: write
    path: ${{ item.path }}
    content: ${{ item.content }}

  - id: summary
    type: shell
    needs: [write_files]
    run: |
      echo "Scaffolding complete. Files created:"
      echo "${{ steps.generate.outputs.files.map(f => f.path).join('\n') }}"
